# ПРОГРАММА КУРСА: "Создание чат-ботов с интеграцией LLM"
## Для системных аналитиков | Python + Telegram Bot API

---

## PET-ПРОЕКТ КУРСА:
**"AI Support Bot — Интеллектуальный помощник поддержки для Telegram"**

Во время курса студенты разработают полнофункционального чат-бота:
- Telegram-бот с inline-клавиатурами и callback обработчиками
- Интеграция с LLM (Yandex GPT / Ollama) для умных ответов
- Системный промпт и персонализация ответов
- Function Calling: расписание, создание заявок
- RAG: база знаний для ответов на вопросы
- Админ-панель на FastAPI с аналитикой
- Docker контейнеризация и деплой в облако

---

## СТРУКТУРА КУРСА "Создание чат-ботов с интеграцией LLM"

### МОДУЛЬ 1: Введение в Telegram-боты и LLM (55 мин.)
**Занятие 1.1: Что такое чат-бот и LLM?** (15 мин.)
- Определение чат-бота: от простых до AI-powered
- Что такое LLM (Large Language Model)
- Примеры использования: поддержка, продажи, FAQ
- Обзор возможностей современных ботов

**Занятие 1.2: Архитектура Telegram-бота с LLM** (20 мин.)
- Telegram Bot API: как работает под капотом
- Polling vs Webhook: когда что использовать
- Архитектура: User → Telegram → Bot Server → LLM → ответ
- Асинхронная обработка сообщений

**Занятие 1.3: Подготовка окружения разработки** (20 мин.)
- Установка Python 3.10+ и настройка виртуального окружения
- Создание бота через @BotFather, получение токена
- Установка Cursor IDE для AI-assisted разработки
- Структура проекта: config, handlers, services

---

### МОДУЛЬ 2: Разработка первого Telegram-бота (60 мин.)
**Занятие 2.1: Установка библиотек и первый echo-bot** (20 мин.)
- Установка aiogram 3.x (современный асинхронный фреймворк)
- Написание простого echo-бота
- Обработка команд: /start, /help
- Запуск и тестирование

**Занятие 2.2: Работа с inline-клавиатурами и callback** (25 мин.)
- InlineKeyboardMarkup и InlineKeyboardButton
- CallbackQuery обработка: data, answer
- Динамические клавиатуры на основе данных
- Практика: меню бота с навигацией

**Занятие 2.3: Использование Cursor AI для написания кода** (15 мин.)
- Промпты для генерации handler'ов
- @-mentions для контекста проекта
- Быстрое прототипирование функций бота
- Отладка с помощью AI

---

### МОДУЛЬ 3: Подключение LLM к боту (70 мин.)
**Занятие 3.1: Выбор LLM: Yandex Cloud vs Ollama** (15 мин.)
- **Yandex GPT**: облачный, русский язык, платный
- **Ollama**: локальный, бесплатный, требует ресурсов
- Сравнение: качество, скорость, стоимость, приватность
- Когда какой вариант выбирать

**Занятие 3.2: Интеграция Yandex Cloud YandexGPT** (20 мин.)
- Создание сервисного аккаунта в Yandex Cloud
- Получение API ключа
- HTTP запросы к Yandex GPT API
- Обработка ответов и форматирование для пользователя

**Занятие 3.3: Интеграция Ollama (локальные модели)** (20 мин.)
- Установка Ollama на локальную машину
- Скачивание модели: `ollama pull mistral`
- Интеграция через HTTP API (localhost:11434)
- Сравнение результатов с облачной моделью

**Занятие 3.4: Обработка ошибок и таймаутов** (15 мин.)
- Timeout handling: LLM может отвечать долго
- Retry логика с экспоненциальной задержкой
- Fallback ответы при недоступности LLM
- Graceful degradation: бот работает даже без LLM

---

### МОДУЛЬ 4: Настройка системного промпта и контекста (50 мин.)
**Занятие 4.1: Что такое системный промпт** (15 мин.)
- System prompt vs User prompt vs Assistant prompt
- Роль системного промпта: персона, ограничения, стиль
- Примеры хороших системных промптов
- Шаблон для бота поддержки

**Занятие 4.2: Персонализация и контекст пользователя** (20 мин.)
- Сохранение контекста диалога (последние N сообщений)
- Персонализация: имя пользователя, история взаимодействий
- Динамическое обогащение промпта данными пользователя
- Управление длиной контекста (token limit)

**Занятие 4.3: Тестирование промптов и A/B тесты** (15 мин.)
- Как тестировать промпты: критерии качества
- A/B тестирование: 2 варианта промпта для разных пользователей
- Сбор метрик: удовлетворённость, длина диалога, конверсия
- Итеративное улучшение промптов

---

### МОДУЛЬ 5: Добавление инструментов (Tools / Function Calling) (70 мин.)
**Занятие 5.1: Что такое Function Calling** (15 мин.)
- Концепция: LLM "вызывает" внешние функции
- JSON schema для описания функций
- Как LLM решает, какую функцию вызвать
- Примеры использования: погода, расписание, заказы

**Занятие 5.2: Создание функции check_schedule** (20 мин.)
- Описание функции в JSON schema
- Реализация: получение расписания из БД/API
- Интеграция с LLM: передача результата обратно
- Тестирование: "Какое расписание на завтра?"

**Занятие 5.3: Создание функции create_ticket** (20 мин.)
- Описание функции: тема, описание, приоритет
- Валидация входных данных от LLM
- Создание тикета в системе (симуляция или реальная интеграция)
- Подтверждение пользователю: "Заявка #123 создана"

**Занятие 5.4: Тестирование и отладка tools** (15 мин.)
- Логирование вызовов функций
- Обработка ошибок: функция вернула ошибку
- Fallback: LLM не смог определить функцию
- Мониторинг использования tools

---

### МОДУЛЬ 6: RAG (Retrieval-Augmented Generation) (60 мин.)
**Занятие 6.1: Что такое RAG и зачем это нужно** (15 мин.)
- Проблема: LLM не знает специфичную информацию
- Решение: поиск релевантных документов + LLM генерация
- Архитектура: Query → Retrieval → Context → Generation
- Примеры: FAQ бот, документация, база знаний

**Занятие 6.2: Создание базы знаний (материалы курса)** (25 мин.)
- Подготовка документов: FAQ, инструкции, правила
- Chunking: разбиение на небольшие части
- Embedding: преобразование в векторы (Yandex Embeddings / local)
- Хранение в vector database (Qdrant / FAISS)

**Занятие 6.3: Поиск релевантных документов и интеграция с LLM** (20 мин.)
- Semantic search: поиск по смыслу, не по словам
- Top-K retrieval: возврат 3-5 релевантных чанков
- Формирование промпта: контекст + вопрос пользователя
- Тестирование: бот отвечает на основе базы знаний

---

### МОДУЛЬ 7: Тестирование и безопасность (45 мин.)
**Занятие 7.1: Unit-тесты для бота** (15 мин.)
- Pytest для тестирования handlers
- Mocking Telegram API и LLM
- Тестирование callback обработчиков
- CI/CD: автоматический запуск тестов

**Занятие 7.2: Безопасность: защита API ключей** (15 мин.)
- .env файлы и python-dotenv
- Secrets management: не коммитить ключи в Git
- Yandex Cloud Secrets Manager (опционально)
- Аудит доступа к ключам

**Занятие 7.3: Rate limiting и защита от спама** (15 мин.)
- Ограничение количества сообщений в минуту
- Throttling: задержка между сообщениями
- Blacklist: блокировка спамеров
- Captcha и верификация (продвинуто)

---

### МОДУЛЬ 8: Логирование, админ-панель, аналитика (70 мин.)
**Занятие 8.1: Настройка логирования** (15 мин.)
- Python logging: уровни, форматы, handlers
- Структурированные логи (JSON)
- Логирование: входящие сообщения, ответы LLM, ошибки
- Ротация логов и хранение

**Занятие 8.2: База данных для хранения взаимодействий (SQLite)** (20 мин.)
- Схема: users, messages, sessions
- SQLAlchemy для ORM
- Сохранение: кто написал, что ответил бот, timestamp
- Метрики: количество пользователей, сообщений, ошибок

**Занятие 8.3: Админ-панель на FastAPI** (25 мин.)
- Создание API endpoints: /stats, /users, /messages
- Простой HTML dashboard (Jinja2 templates)
- Аутентификация для админов
- Просмотр диалогов и статистики

**Занятие 8.4: Дашборды с Grafana (или простая визуализация)** (10 мин.)
- Экспорт метрик в Prometheus (опционально)
- Grafana дашборды: графики, алерты
- Альтернатива: простые графики в админ-панели (Chart.js)
- KPI: активные пользователи, response time, error rate

---

### МОДУЛЬ 9: Развертывание в Production (60 мин.)
**Занятие 9.1: Docker контейнеризация** (20 мин.)
- Dockerfile для Python бота
- docker-compose: бот + база данных + vector DB
- Environment variables в Docker
- Локальное тестирование контейнера

**Занятие 9.2: Развертывание на Yandex Cloud / DigitalOcean** (25 мин.)
- Создание VM в облаке
- Установка Docker на сервере
- Настройка Webhook (HTTPS required)
- Запуск бота в production режиме

**Занятие 9.3: CI/CD и мониторинг** (15 мин.)
- GitHub Actions для автоматического деплоя
- Health checks и restart policies
- Alerting: уведомления при падении бота
- Обновление без downtime (rolling update)

---

### МОДУЛЬ 10: Продвинутые техники (БОНУС) (45 мин.)
**Занятие 10.1: Streaming ответов LLM** (15 мин.)
- Проблема: долгие ответы LLM раздражают пользователей
- Решение: streaming (постепенный вывод)
- Реализация в Telegram: edit_message_text
- UX: пользователь видит "бот печатает..."

**Занятие 10.2: Multi-agent боты** (15 мин.)
- Несколько "агентов" с разными ролями
- Router agent: определяет, кому передать запрос
- Specialist agents: продажи, поддержка, FAQ
- Оркестрация и передача контекста между агентами

**Занятие 10.3: Fine-tuning LLM на специфичные задачи** (15 мин.)
- Когда нужен fine-tuning: специфичный домен, стиль
- Подготовка датасета: пары вопрос-ответ
- Fine-tuning через Yandex DataSphere (обзор)
- Альтернатива: few-shot learning в промптах
